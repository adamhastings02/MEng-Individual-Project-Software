# A Radiology Data Extraction (RADEX) tool for fast and accurate information curation from free-text reports
## About the Project
This project presents the development of an in-house tool called RADEX, which uses regular expressions to extract structured information from radiology reports of the neck performed within Leeds Teaching Hospital Trust. Reports generated by radiologists / radiographers contain a significant amount of information regarding the diagnosis of a patient after medical imaging, yet there is no standardised approach to filling out these reports. This project evaluates the use of natural language processing techniques to automate the extraction of key data points from these reports. The existing RADEX tool could extract information from radiology reports using command line instructions, which would be challenging for a clinician to use who has no prior knowledge of regular expressions or Python, hence a more intuitive and powerful tool would be extremely valuable to clinicians to speed up the process of patient triage, support their decision making, and reduce their workload. 

In this work, a graphical user interface has been developed to make the process of searching and analysing records much simpler, as well as providing a more powerful analysis of the results. The GUI can be launched through a standalone executable program, so the user needs no prior knowledge or installations of Python and is protected through a login system. The main window of the GUI consists of various widgets and tools that make forming searches simple, with assistance through tooltips and help windows which allows clinicians to perform highly specific and complex searches, whilst also conforming to digital accessibility guidelines. Furthermore, a custom named entity recognition model has been trained to highlight the reports with searched terms, quantities, and medical nomenclature, where the highlighting options are fully customisable. Finally, a new algorithm has been developed to highlight the certainty in the classification by the toolâ€™s processing and regular expression searching, which guides the user on whether to cross reference the processed report with the unprocessed one, whilst always conforming to strict timing constraints. 

It has been demonstrated that the upgraded tool is significantly better, with the numerous additional features proving useful when tested by a radiologist. The speed of tool usage has not been adversely affected, nor has the accuracy, but now has options to improve accuracy by customising the data pre-processing options. Future work could make the tool even better, such as further training of the named entity recognition model, or more options for the user regarding setting up the desired dataset. 

## Table of Contents
[Usage Information](#Usage)

[Repository Files](#Files-in-this-Repository)

[System at a Glance](#System-at-a-Glance)

[Project Roadmap](#Roadmap)

[Contributors](#Contributors-to-this-Project)

## Usage
### General Usage
This repository has been developed on Visual Studio Code, using Python 3.10.8. Other software used includes Qt Designer, DBBrowser, MATLAB and Excel

### Clone the repo with submodules
```bash
git clone --recurse-submodules https://github.com/ljhowell/radiology_reports
```

### Installation
Using pipenv:

```bash
pipenv install
```
Using pip:

```bash
pip install -r requirements.txt
```

## Files in this Repository
#### readme.md
You are reading this currently

The following key files are provided:

| File | Purpose |
| ---  | --- |
| `main.py`                 | Main Program for this system |
| `database.py`             | Program to deal with database creation, insertion and deletion |
| `requirements.txt`        | Text file containing the dependencies for this project |
| `GraphPlot.m`             | A MATLAB script to plot a graph |

#### /data
This folder contains the synthetic ultrasound reports used for testing the program. Also contains data used to train the NER model, as well as the Excel Plugin. Finally, it contains the list of terms used for the MeSH term searching

#### /dist
Contains the distribution file for deploying the standalone program (.exe file)

#### /guis
This folder contains all of the generated GUI files from Qt Designer

#### /medication_ner_model, model-best, model-last
These folders contain the models for the NER algorithms

#### /NegEx
This folder houses the NegEx content, used for identification of negation within the text. 

#### /nlprules
Contains all the pre-existing RADEX IP developed by Lewis Howell, as acknowledged later.

## System at a Glance

![MainWindowClear](https://github.com/adamhastings02/MEng-Individual-Project-Software/assets/127940024/b8bd7eb3-2e73-452a-ad60-2333a07599e0)

Figure 1 - The program's main window

![preprocessing drawio](https://github.com/adamhastings02/MEng-Individual-Project-Software/assets/127940024/221092e9-5c2c-46dc-96dc-931c25ed4725)

Figure 2 - Pre-Processing steps applied to the reports

![programflowchart](https://github.com/adamhastings02/MEng-Individual-Project-Software/assets/127940024/658f0e62-6eb1-43df-bd97-f97f5db330f0)

Figure 3 - Program Flowchart

## Roadmap 
### Project Development Process after meeting:
Confidentiality and safety
- [x] Need to emphasise it is an offline program for personal/institutional use and highlight the anonymisation feature
- [x] Option to encrypt/password protect output files would be a bonus but not necessary

Data input
- [x] Convert Excel files/sheets into correct format for processing or signpost the user how to do this
- [x] Define date format for columns containing dates (e.g. dd/mm/yyyyy vs mm/dd/yyyy); only necessary if we can do date-based regex rules/searches

Data cleansing and optimisation
- [x] Remove extra spaces within user selectable columns (e.g. NHS IDs; might need to do this to ensure correct merging of data based on a unique ID)
- [x] Duplicate warning might be a good idea for columns containing unique IDs; prompts the user to remove duplicates or merge their data (e.g. multi-part examination into a single row). Not sure we can implement a way to choose and remove duplicates if they wish to do so within the GUI. 

Anonymisation
- [x] I think this should come after the user is happy with the way their input file has been cleansed/optimised
- [x] Strip confidential data. This can either be with the user choosing to delete columns containing such data, or if there are confidential information embedded within fields, maybe a search and replace function can work.

Regex searches
- [x] Filter data based on criteria (e.g. exam date column before 01/01/2020) and only perform regex search on the 'report' column of the filtered data. I think a filtering option before doing a regex search would be simpler than trying to incorporate the filtering within a complex regex search.
- [x] Combine/integrate regex searches with look-up tables (e.g. dictionary of words with same/similar meaning/descriptors, or list of positive or negative phrases [e.g. "no evidence of x", "x is not demonstrated")
- [x] Save steps for future use with new data (eg load settings, export for other users etc)

Regex output
- [x] Show matching criteria in bold or colour based on user preference. If performing multiple separate searches on the same field, highlight the results for each search in a different colour.
- [x] Output result(s) into new custom columns based on regex searches (with option for binary output (found/not found) or copy of found text). User defines the name of the new column/field.
- [x] Review screen. User can scroll through the output and accepts/rejects the output of the regex search, or manually enters data into the output table. The review screen should be user friendly and allow filtering of the columns and sorting alphabetically or numerically (i.e. user might want to review certain filtered data, but accept all other outputs if they have a robust regex search)
- [x] Once the output has been reviewed, user can either export the data or feed the new 'table' back into the GUI to run more searches (either on different columns or on the new/amended data). 

### Future Work
- [ ] Accept multiple files (or Excel sheets) to enable merging of multiple datasets using unique IDs
- [ ] Allow user to select which row contains the column headers on loading of data file, or if no headers are present within the dataset they should be able to define the column headers on input
- [ ] On loading user selects which columns contain unique IDs
- [ ] Transpose columns to rows; not necessary but a bonus feature (for data arranged the other way to what I've included)
- [ ] Merge rows based on a unique ID (selected by user at point of merging). User selects which fields to merge (e.g. merge multiple report fields for a multi-part examination on the same patient/event, but not necessary to merge the patient's age field as they will be the same across all the rows)
- [ ] Merge data from two tables based on a unique ID as above (e.g. useful for merging radiology and pathology datasets). Again, user chooses which fields to merge or copies across (if the field is only available in one of the datasets)
- [ ] For patients with multiple exams at different time-points (different event key; not a multi-part exam with same event key), it is often required to know the order of the exams and create a column for this. It would be great to be able to do this in the GUI (i.e. same patient ID but multiple even keys, the new column would then contain 1 for the row with the earliest exam, 2 for next etc.) 
- [ ] Remove rows or columns based on criteria (e.g. remove all rows that contain x in the y column/field)
- [ ] Save cleansing/optimisation steps for future use with new data (eg load settings, export for other users etc). This would be very handy for projects requiring (new) data input  at different time points, especially as the source file output format from CRIS will be identical and would require the same optimisation steps before running regex searches.

## Contributors to this Project
### Contributors
The following people have contributed to this project. Their names and emails are listed below, if you wish to seek guidance regarding any features within this repository:
+ Adam Hastings, el20ah@leeds.ac.uk
+ Lewis Howell, scljh@leeds.ac.uk

### Acknowledgements
1. Dr. James McLaughlan - For his invaluable guidance, support, and detailed feedback throughout the project. 
2. Dr. Amir Zarei - For his valuable input and suggested features. In addition, I would like to thank him for inviting me to test my project on real patient data.
3. Mr. Lewis Howell - For his technical advice, valuable discussions, and explanations on various aspects of the project. In particular, the excellent Jupyter Notebook and thorough code commenting on existing IP, which assisted developing this project. 
